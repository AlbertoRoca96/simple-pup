name: Catalog Refresh
on:
 schedule:
 - cron: '0 6 * * *' 
 workflow_dispatch: {}
permissions:
 contents: write
jobs:
 refresh:
 runs-on: ubuntu-latest
 steps:
 - uses: actions/checkout@v4
 - uses: actions/setup-node@v4
 with:
 node-version: 20
 cache: npm
 - run: npm ci
 - name: Fetch Walmart catalog via official API
 env:
 WALMART_CLIENT_ID: ${{ secrets.WALMART_CLIENT_ID }}
 WALMART_CLIENT_SECRET: ${{ secrets.WALMART_CLIENT_SECRET }}
 WALMART_QUERIES: ${{ vars.WALMART_QUERIES || 'Electric Bike,E-Bike,Hyper,Vivi,Schwinn,Huffy,700C,29" MTB,Mid-Drive,Folding Ebike,Fat Tire Ebike,Commuter Ebike,Beach Cruiser Ebike,Jetson,Ancheer,Heybike,Nakto' }}
 run: node scripts/walmart_api_fetch.mjs
 - name: Create Pull Request with refreshed data
 uses: peter-evans/create-pull-request@v6
 with:
 commit-message: 'chore(data): refresh Walmart catalog' 
 title: 'chore(data): refresh Walmart catalog' 
 body: 'Automated refresh of public/data/* JSON files' 
 branch: chore/refresh-catalog